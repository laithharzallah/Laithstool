<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TPRM Intelligence - DART Registry</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/modern-styles.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.10.3/dist/cdn.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.0/dist/echarts.min.js"></script>
    <style>
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .org-chart-node {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 8px;
            padding: 12px;
            transition: all 0.3s ease;
        }
        .org-chart-node:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            border-color: #10b981;
        }
        .financial-metric {
            position: relative;
            overflow: hidden;
        }
        .financial-metric::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, #10b981, #3b82f6);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease;
        }
        .financial-metric:hover::after {
            transform: scaleX(1);
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen" x-data="dartRegistryApp()">
    <!-- Header Navigation -->
    <header class="bg-gray-800/50 backdrop-blur-md border-b border-gray-700 fixed top-0 left-0 right-0 z-50">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between py-4">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-shield-alt text-3xl text-indigo-500"></i>
                    <h1 class="text-2xl font-bold gradient-text">TPRM Intelligence</h1>
                </div>
                <nav class="hidden md:flex items-center space-x-6">
                    <a href="/" class="nav-item text-gray-300 hover:text-white transition-colors py-2">Dashboard</a>
                    <a href="/enhanced/company_screening" class="nav-item text-gray-300 hover:text-white transition-colors py-2">Company Screening</a>
                    <a href="/enhanced/individual_screening" class="nav-item text-gray-300 hover:text-white transition-colors py-2">Individual Screening</a>
                    <a href="/enhanced/dart_registry" class="nav-item text-white font-medium py-2">DART Registry</a>
                </nav>
                <div class="flex items-center space-x-4">
                    <button @click="showNotifications = !showNotifications" class="text-gray-400 hover:text-white transition-colors relative">
                        <i class="fas fa-bell text-xl"></i>
                    </button>
                    <button class="text-gray-400 hover:text-white transition-colors">
                        <i class="fas fa-cog text-xl"></i>
                    </button>
                    <div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full flex items-center justify-center">
                        <i class="fas fa-user text-sm"></i>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-24">
        <!-- Page Header -->
        <div class="mb-8">
            <div class="flex items-center justify-between mb-4">
                <div>
                    <h2 class="text-3xl font-bold">DART Registry</h2>
                    <p class="text-gray-400 mt-2">Korean Financial Supervisory Service corporate registry and filings</p>
                </div>
                <div class="flex items-center space-x-4">
                    <button @click="showAdvancedSearch = true" class="btn-outline px-4 py-2 rounded-lg text-sm">
                        <i class="fas fa-filter mr-2"></i> Advanced Search
                    </button>
                    <button @click="showWatchlist = true" class="btn-outline px-4 py-2 rounded-lg text-sm">
                        <i class="fas fa-star mr-2"></i> Watchlist
                    </button>
                </div>
            </div>
            <div class="flex items-center space-x-4 text-sm">
                <span class="flex items-center text-green-400">
                    <i class="fas fa-check-circle mr-1"></i> Official FSS Data
                </span>
                <span class="flex items-center text-gray-400">
                    <i class="fas fa-sync mr-1"></i> Real-time Updates
                </span>
                <span class="flex items-center text-gray-400">
                    <i class="fas fa-language mr-1"></i> Korean & English
                </span>
            </div>
        </div>

        <!-- Search Form -->
        <div class="modern-card mb-8" x-show="!loading && !results && !searchResults">
            <h3 class="text-xl font-semibold mb-6">Search Korean Companies</h3>
            <form @submit.prevent="performSearch" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Company Name *</label>
                        <div class="relative">
                            <input type="text" x-model="searchForm.company" required 
                                @input="suggestCompanies"
                                class="input-modern pr-10" placeholder="e.g., Samsung Electronics">
                            <i class="fas fa-search absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500"></i>
                        </div>
                        <!-- Suggestions dropdown -->
                        <div x-show="suggestions.length > 0" class="absolute z-10 w-full mt-1 bg-gray-800 rounded-lg shadow-lg border border-gray-700">
                            <ul class="py-2">
                                <template x-for="suggestion in suggestions" :key="suggestion.corp_code">
                                    <li @click="selectSuggestion(suggestion)" 
                                        class="px-4 py-2 hover:bg-gray-700 cursor-pointer text-sm">
                                        <div class="font-medium" x-text="suggestion.name"></div>
                                        <div class="text-xs text-gray-400" x-text="suggestion.corp_code"></div>
                                    </li>
                                </template>
                            </ul>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Registry ID (Corp Code)</label>
                        <input type="text" x-model="searchForm.registry_id" 
                            class="input-modern" placeholder="e.g., 00126380">
                    </div>
                </div>
                <div class="flex items-center justify-between pt-4">
                    <div class="flex items-center space-x-4 text-sm">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" x-model="searchOptions.includeInactive" 
                                class="w-4 h-4 text-green-600 bg-gray-700 border-gray-600 rounded">
                            <span class="text-gray-400">Include inactive companies</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" x-model="searchOptions.includeSubsidiaries" 
                                class="w-4 h-4 text-green-600 bg-gray-700 border-gray-600 rounded">
                            <span class="text-gray-400">Include subsidiaries</span>
                        </label>
                    </div>
                    <button type="submit" class="btn-primary px-6 py-3 rounded-lg font-medium">
                        <i class="fas fa-search mr-2"></i> Search Registry
                    </button>
                </div>
            </form>
        </div>

        <!-- Loading State -->
        <div class="modern-card text-center py-12" x-show="loading" x-cloak>
            <div class="loading-spinner mx-auto mb-4"></div>
            <h3 class="text-xl font-semibold mb-2">Searching DART Registry</h3>
            <p class="text-gray-400" x-text="loadingMessage"></p>
            <div class="mt-6 max-w-md mx-auto">
                <div class="progress-bar">
                    <div class="progress-bar-fill" :style="`width: ${loadingProgress}%`"></div>
                </div>
            </div>
        </div>

        <!-- Search Results List -->
        <div x-show="searchResults && searchResults.length > 0 && !results" x-cloak class="space-y-4">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-semibold">Search Results</h3>
                <span class="text-sm text-gray-400">
                    Found <span x-text="searchResults.length"></span> companies
                </span>
            </div>
            <div class="grid grid-cols-1 gap-4">
                <template x-for="company in searchResults" :key="company.corp_code">
                    <div @click="selectCompany(company)" 
                        class="modern-card hover:border-green-500 cursor-pointer transition-all">
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="text-lg font-semibold" x-text="company.name"></h4>
                                <div class="flex items-center space-x-4 mt-1 text-sm text-gray-400">
                                    <span><i class="fas fa-id-badge mr-1"></i> <span x-text="company.corp_code"></span></span>
                                    <span x-show="company.stock_code">
                                        <i class="fas fa-chart-line mr-1"></i> <span x-text="company.stock_code"></span>
                                    </span>
                                </div>
                            </div>
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </div>
                    </div>
                </template>
            </div>
            <button @click="clearSearchResults" class="btn-outline px-4 py-2 rounded-lg text-sm">
                <i class="fas fa-arrow-left mr-2"></i> New Search
            </button>
        </div>

        <!-- Company Details -->
        <div x-show="results" x-cloak class="space-y-6">
            <!-- Company Header -->
            <div class="modern-card bg-gradient-to-r from-green-900/20 to-blue-900/20">
                <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-6">
                    <div class="flex items-start space-x-4">
                        <div class="w-20 h-20 bg-gradient-to-br from-green-500 to-blue-600 rounded-xl flex items-center justify-center">
                            <i class="fas fa-building text-3xl text-white"></i>
                        </div>
                        <div>
                            <h3 class="text-3xl font-bold mb-2" x-text="results.company_name"></h3>
                            <div class="flex flex-wrap items-center gap-3 text-sm">
                                <span class="text-gray-400">
                                    <i class="fas fa-id-badge mr-1"></i>
                                    Registry: <span x-text="results.registry_id"></span>
                                </span>
                                <span class="badge badge-success">
                                    <i class="fas fa-check-circle mr-1"></i>
                                    <span x-text="results.status"></span>
                                </span>
                                <span class="text-gray-400" x-show="results.industry_name">
                                    <i class="fas fa-industry mr-1"></i>
                                    <span x-text="results.industry_name"></span>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button @click="addToWatchlist" class="btn-outline px-4 py-2 rounded-lg">
                            <i class="fas fa-star mr-2"></i> Watch
                        </button>
                        <button @click="downloadProfile" class="btn-primary px-4 py-2 rounded-lg">
                            <i class="fas fa-download mr-2"></i> Export
                        </button>
                    </div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="modern-card text-center financial-metric">
                    <div class="text-sm text-gray-400 mb-2">Market Cap</div>
                    <div class="text-2xl font-bold text-green-400" x-text="formatCurrency(getLatestFinancial('assets'))"></div>
                </div>
                <div class="modern-card text-center financial-metric">
                    <div class="text-sm text-gray-400 mb-2">Revenue</div>
                    <div class="text-2xl font-bold text-blue-400" x-text="formatCurrency(getLatestFinancial('revenue'))"></div>
                </div>
                <div class="modern-card text-center financial-metric">
                    <div class="text-sm text-gray-400 mb-2">Profit</div>
                    <div class="text-2xl font-bold" 
                        :class="getLatestFinancial('profit') > 0 ? 'text-green-400' : 'text-red-400'"
                        x-text="formatCurrency(getLatestFinancial('profit'))"></div>
                </div>
                <div class="modern-card text-center financial-metric">
                    <div class="text-sm text-gray-400 mb-2">Employees</div>
                    <div class="text-2xl font-bold text-purple-400">N/A</div>
                </div>
            </div>

            <!-- Main Content Tabs -->
            <div class="modern-card p-0">
                <div class="tabs flex overflow-x-auto">
                    <button @click="activeTab = 'overview'" class="tab px-6 py-4"
                        :class="{'active': activeTab === 'overview'}">
                        <i class="fas fa-info-circle mr-2"></i> Overview
                    </button>
                    <button @click="activeTab = 'financial'" class="tab px-6 py-4"
                        :class="{'active': activeTab === 'financial'}">
                        <i class="fas fa-chart-line mr-2"></i> Financials
                    </button>
                    <button @click="activeTab = 'structure'" class="tab px-6 py-4"
                        :class="{'active': activeTab === 'structure'}">
                        <i class="fas fa-sitemap mr-2"></i> Structure
                    </button>
                    <button @click="activeTab = 'documents'" class="tab px-6 py-4"
                        :class="{'active': activeTab === 'documents'}">
                        <i class="fas fa-file-alt mr-2"></i> Documents
                    </button>
                    <button @click="activeTab = 'analysis'" class="tab px-6 py-4"
                        :class="{'active': activeTab === 'analysis'}">
                        <i class="fas fa-brain mr-2"></i> Analysis
                    </button>
                </div>

                <!-- Tab Content -->
                <div class="p-6">
                    <!-- Overview Tab -->
                    <div x-show="activeTab === 'overview'" class="tab-content space-y-6">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div>
                                <h4 class="text-lg font-semibold mb-3 text-green-300">
                                    <i class="fas fa-info-circle mr-2"></i>Company Information
                                </h4>
                                <div class="bg-gray-800/50 rounded-lg overflow-hidden">
                                    <table class="table-modern">
                                        <tbody>
                                            <tr>
                                                <td class="font-medium text-gray-400">Registration Date</td>
                                                <td x-text="results.registration_date || 'Not available'"></td>
                                            </tr>
                                            <tr>
                                                <td class="font-medium text-gray-400">Industry Code</td>
                                                <td x-text="results.industry_code || 'Not available'"></td>
                                            </tr>
                                            <tr>
                                                <td class="font-medium text-gray-400">Representative</td>
                                                <td x-text="results.representative || 'Not available'"></td>
                                            </tr>
                                            <tr>
                                                <td class="font-medium text-gray-400">Capital</td>
                                                <td x-text="results.capital || 'Not available'"></td>
                                            </tr>
                                            <tr>
                                                <td class="font-medium text-gray-400">Address</td>
                                                <td x-text="results.address || 'Not available'"></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div>
                                <h4 class="text-lg font-semibold mb-3 text-green-300">
                                    <i class="fas fa-chart-pie mr-2"></i>Ownership Distribution
                                </h4>
                                <div class="bg-gray-800/50 rounded-lg p-4" style="height: 300px;">
                                    <canvas id="ownershipChart"></canvas>
                                </div>
                            </div>
                        </div>

                        <div x-show="results.major_shareholders && results.major_shareholders.length > 0">
                            <h4 class="text-lg font-semibold mb-3 text-green-300">
                                <i class="fas fa-users mr-2"></i>Major Shareholders
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <template x-for="shareholder in results.major_shareholders" :key="shareholder.name">
                                    <div class="bg-gray-800/50 rounded-lg p-4 flex items-center justify-between">
                                        <div>
                                            <h5 class="font-semibold" x-text="shareholder.name"></h5>
                                            <p class="text-sm text-gray-400" x-text="shareholder.relationship"></p>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-xl font-bold text-green-400" x-text="shareholder.ownership"></div>
                                            <div class="text-xs text-gray-400">Ownership</div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>

                    <!-- Financial Tab -->
                    <div x-show="activeTab === 'financial'" class="tab-content space-y-6">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="text-lg font-semibold text-green-300">
                                <i class="fas fa-chart-line mr-2"></i>Financial Performance
                            </h4>
                            <select x-model="financialView" class="select-modern text-sm w-40">
                                <option value="yearly">Yearly</option>
                                <option value="quarterly">Quarterly</option>
                            </select>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-gray-800/50 rounded-lg p-4">
                                <h5 class="font-medium mb-3">Revenue & Profit Trend</h5>
                                <canvas id="revenueChart"></canvas>
                            </div>
                            <div class="bg-gray-800/50 rounded-lg p-4">
                                <h5 class="font-medium mb-3">Asset Growth</h5>
                                <canvas id="assetChart"></canvas>
                            </div>
                        </div>

                        <div>
                            <h5 class="font-semibold mb-3">Financial Summary</h5>
                            <div class="bg-gray-800/50 rounded-lg overflow-hidden">
                                <table class="table-modern">
                                    <thead>
                                        <tr>
                                            <th>Metric</th>
                                            <template x-for="year in Object.keys(results.financial_summary?.revenue || {}).sort().reverse().slice(0, 3)" :key="year">
                                                <th x-text="year"></th>
                                            </template>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="font-medium text-gray-400">Revenue</td>
                                            <template x-for="year in Object.keys(results.financial_summary?.revenue || {}).sort().reverse().slice(0, 3)" :key="year">
                                                <td x-text="formatCurrency(results.financial_summary.revenue[year])"></td>
                                            </template>
                                        </tr>
                                        <tr>
                                            <td class="font-medium text-gray-400">Profit</td>
                                            <template x-for="year in Object.keys(results.financial_summary?.profit || {}).sort().reverse().slice(0, 3)" :key="year">
                                                <td x-text="formatCurrency(results.financial_summary.profit[year])"
                                                    :class="results.financial_summary.profit[year] < 0 ? 'text-red-400' : ''"></td>
                                            </template>
                                        </tr>
                                        <tr>
                                            <td class="font-medium text-gray-400">Assets</td>
                                            <template x-for="year in Object.keys(results.financial_summary?.assets || {}).sort().reverse().slice(0, 3)" :key="year">
                                                <td x-text="formatCurrency(results.financial_summary.assets[year])"></td>
                                            </template>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="bg-gray-800/50 rounded-lg p-4 text-center">
                                <div class="text-sm text-gray-400 mb-1">P/E Ratio</div>
                                <div class="text-xl font-bold text-blue-400">23.5</div>
                            </div>
                            <div class="bg-gray-800/50 rounded-lg p-4 text-center">
                                <div class="text-sm text-gray-400 mb-1">ROE</div>
                                <div class="text-xl font-bold text-green-400">15.2%</div>
                            </div>
                            <div class="bg-gray-800/50 rounded-lg p-4 text-center">
                                <div class="text-sm text-gray-400 mb-1">Debt Ratio</div>
                                <div class="text-xl font-bold text-yellow-400">45.3%</div>
                            </div>
                            <div class="bg-gray-800/50 rounded-lg p-4 text-center">
                                <div class="text-sm text-gray-400 mb-1">Profit Margin</div>
                                <div class="text-xl font-bold text-purple-400">8.7%</div>
                            </div>
                        </div>
                    </div>

                    <!-- Structure Tab -->
                    <div x-show="activeTab === 'structure'" class="tab-content space-y-6">
                        <h4 class="text-lg font-semibold mb-4 text-green-300">
                            <i class="fas fa-sitemap mr-2"></i>Corporate Structure
                        </h4>

                        <div class="bg-gray-800/50 rounded-lg p-6" id="orgChart" style="height: 400px;">
                            <!-- Organization chart will be rendered here -->
                        </div>

                        <div x-show="results.subsidiaries && results.subsidiaries.length > 0">
                            <h5 class="font-semibold mb-3">Subsidiaries</h5>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <template x-for="subsidiary in results.subsidiaries" :key="subsidiary.name">
                                    <div class="bg-gray-800/50 rounded-lg p-4">
                                        <div class="flex items-start justify-between mb-2">
                                            <h6 class="font-medium" x-text="subsidiary.name"></h6>
                                            <span class="badge badge-info text-xs" x-text="subsidiary.ownership"></span>
                                        </div>
                                        <p class="text-sm text-gray-400" x-text="subsidiary.business"></p>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>

                    <!-- Documents Tab -->
                    <div x-show="activeTab === 'documents'" class="tab-content">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="text-lg font-semibold text-green-300">
                                <i class="fas fa-file-alt mr-2"></i>Recent Filings
                            </h4>
                            <div class="flex items-center space-x-2">
                                <select x-model="documentFilter" class="select-modern text-sm w-40">
                                    <option value="all">All Documents</option>
                                    <option value="annual">Annual Reports</option>
                                    <option value="quarterly">Quarterly Reports</option>
                                    <option value="audit">Audit Reports</option>
                                </select>
                            </div>
                        </div>

                        <div x-show="results.documents && results.documents.length > 0" class="space-y-3">
                            <template x-for="doc in filteredDocuments()" :key="doc.id">
                                <div class="bg-gray-800/50 rounded-lg p-4 hover:bg-gray-800/70 transition-colors">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h5 class="font-medium mb-1" x-text="doc.title"></h5>
                                            <div class="flex items-center space-x-3 text-sm text-gray-400">
                                                <span><i class="fas fa-calendar mr-1"></i> <span x-text="doc.date"></span></span>
                                                <span><i class="fas fa-file mr-1"></i> <span x-text="doc.id"></span></span>
                                            </div>
                                        </div>
                                        <a :href="doc.url" target="_blank" 
                                            class="btn-outline px-3 py-1 text-sm rounded">
                                            <i class="fas fa-download mr-1"></i> View
                                        </a>
                                    </div>
                                </div>
                            </template>
                        </div>

                        <div x-show="!results.documents || results.documents.length === 0" 
                            class="text-center py-12 text-gray-400">
                            <i class="fas fa-file-alt text-4xl mb-4"></i>
                            <p>No documents available</p>
                        </div>
                    </div>

                    <!-- Analysis Tab -->
                    <div x-show="activeTab === 'analysis'" class="tab-content space-y-6">
                        <h4 class="text-lg font-semibold mb-4 text-green-300">
                            <i class="fas fa-brain mr-2"></i>AI-Powered Analysis
                        </h4>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-gray-800/50 rounded-lg p-6">
                                <h5 class="font-semibold mb-3 text-blue-300">Financial Health Score</h5>
                                <div class="relative pt-1">
                                    <div class="flex mb-2 items-center justify-between">
                                        <div>
                                            <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-green-600 bg-green-200">
                                                Healthy
                                            </span>
                                        </div>
                                        <div class="text-right">
                                            <span class="text-xs font-semibold inline-block text-green-600">
                                                85%
                                            </span>
                                        </div>
                                    </div>
                                    <div class="overflow-hidden h-2 mb-4 text-xs flex rounded bg-gray-700">
                                        <div style="width:85%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-green-500"></div>
                                    </div>
                                </div>
                                <ul class="text-sm text-gray-300 space-y-1">
                                    <li><i class="fas fa-check text-green-400 mr-2"></i>Strong revenue growth</li>
                                    <li><i class="fas fa-check text-green-400 mr-2"></i>Healthy profit margins</li>
                                    <li><i class="fas fa-exclamation-triangle text-yellow-400 mr-2"></i>Moderate debt levels</li>
                                </ul>
                            </div>

                            <div class="bg-gray-800/50 rounded-lg p-6">
                                <h5 class="font-semibold mb-3 text-purple-300">Market Position</h5>
                                <div class="text-center mb-4">
                                    <div class="text-4xl font-bold text-purple-400">#2</div>
                                    <div class="text-sm text-gray-400">Industry Ranking</div>
                                </div>
                                <ul class="text-sm text-gray-300 space-y-1">
                                    <li><i class="fas fa-chart-line text-purple-400 mr-2"></i>Market share: 28.5%</li>
                                    <li><i class="fas fa-trophy text-purple-400 mr-2"></i>Technology leader</li>
                                    <li><i class="fas fa-globe text-purple-400 mr-2"></i>Global presence</li>
                                </ul>
                            </div>
                        </div>

                        <div class="bg-gray-800/50 rounded-lg p-6">
                            <h5 class="font-semibold mb-3">Key Insights</h5>
                            <div class="space-y-3">
                                <div class="flex items-start">
                                    <i class="fas fa-lightbulb text-yellow-400 mt-1 mr-3"></i>
                                    <p class="text-sm text-gray-300">The company has shown consistent revenue growth over the past 3 years, with a CAGR of 12.5%</p>
                                </div>
                                <div class="flex items-start">
                                    <i class="fas fa-lightbulb text-yellow-400 mt-1 mr-3"></i>
                                    <p class="text-sm text-gray-300">Strong R&D investment (15% of revenue) positions the company well for future innovation</p>
                                </div>
                                <div class="flex items-start">
                                    <i class="fas fa-lightbulb text-yellow-400 mt-1 mr-3"></i>
                                    <p class="text-sm text-gray-300">Diversified revenue streams across multiple geographic regions reduce concentration risk</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="modern-card flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button @click="generateReport" class="btn-outline px-4 py-2 rounded-lg">
                        <i class="fas fa-file-pdf mr-2"></i> Generate Report
                    </button>
                    <button @click="compareCompanies" class="btn-outline px-4 py-2 rounded-lg">
                        <i class="fas fa-balance-scale mr-2"></i> Compare
                    </button>
                    <button @click="shareProfile" class="btn-outline px-4 py-2 rounded-lg">
                        <i class="fas fa-share-alt mr-2"></i> Share
                    </button>
                </div>
                <button @click="newSearch" class="btn-primary px-6 py-2 rounded-lg">
                    <i class="fas fa-plus mr-2"></i> New Search
                </button>
            </div>
        </div>
    </main>

    <script>
        function dartRegistryApp() {
            return {
                searchForm: {
                    company: '',
                    registry_id: ''
                },
                searchOptions: {
                    includeInactive: false,
                    includeSubsidiaries: false
                },
                loading: false,
                loadingMessage: 'Searching DART registry...',
                loadingProgress: 0,
                results: null,
                searchResults: null,
                suggestions: [],
                activeTab: 'overview',
                showAdvancedSearch: false,
                showWatchlist: false,
                financialView: 'yearly',
                documentFilter: 'all',

                init() {
                    this.$watch('results', (value) => {
                        if (value) {
                            this.$nextTick(() => {
                                this.initCharts();
                                this.initOrgChart();
                            });
                        }
                    });
                },

                performSearch() {
                    this.loading = true;
                    this.loadingProgress = 0;
                    this.results = null;
                    this.searchResults = null;
                    
                    const progressInterval = setInterval(() => {
                        if (this.loadingProgress < 90) {
                            this.loadingProgress += Math.random() * 20;
                            this.updateLoadingMessage();
                        }
                    }, 300);

                    // First, search for companies
                    fetch('/api/dart/search', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(this.searchForm)
                    })
                    .then(response => response.json())
                    .then(data => {
                        clearInterval(progressInterval);
                        this.loadingProgress = 100;
                        
                        if (data.companies && data.companies.length > 0) {
                            if (data.companies.length === 1) {
                                // Single result, fetch details directly
                                this.selectCompany(data.companies[0]);
                            } else {
                                // Multiple results, show list
                                this.searchResults = data.companies;
                                this.loading = false;
                            }
                        } else {
                            this.loading = false;
                            alert('No companies found');
                        }
                    })
                    .catch(error => {
                        clearInterval(progressInterval);
                        this.loading = false;
                        alert('Error searching DART: ' + error.message);
                    });
                },

                selectCompany(company) {
                    this.loading = true;
                    this.searchResults = null;
                    
                    // Fetch detailed company info
                    fetch('/api/dart_lookup', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            company: company.name,
                            registry_id: company.corp_code 
                        })
                    })
                    .then(response => response.json())
                    .then(data => {
                        this.results = data;
                        this.loading = false;
                        this.activeTab = 'overview';
                    })
                    .catch(error => {
                        this.loading = false;
                        alert('Error fetching company details: ' + error.message);
                    });
                },

                updateLoadingMessage() {
                    const messages = [
                        'Connecting to DART registry...',
                        'Searching company database...',
                        'Retrieving financial data...',
                        'Loading corporate structure...',
                        'Fetching recent filings...',
                        'Analyzing company information...'
                    ];
                    const index = Math.floor((this.loadingProgress / 100) * messages.length);
                    this.loadingMessage = messages[Math.min(index, messages.length - 1)];
                },

                suggestCompanies() {
                    // Implement auto-suggest functionality
                    this.suggestions = [];
                },

                selectSuggestion(suggestion) {
                    this.searchForm.company = suggestion.name;
                    this.searchForm.registry_id = suggestion.corp_code;
                    this.suggestions = [];
                },

                formatCurrency(value) {
                    if (!value) return 'N/A';
                    const currency = this.results?.financial_summary?.currency || 'KRW';
                    
                    if (value >= 1000000000) {
                        return `${(value / 1000000000).toFixed(1)}B ${currency}`;
                    } else if (value >= 1000000) {
                        return `${(value / 1000000).toFixed(1)}M ${currency}`;
                    } else {
                        return `${value.toLocaleString()} ${currency}`;
                    }
                },

                getLatestFinancial(metric) {
                    if (!this.results?.financial_summary?.[metric]) return 0;
                    const years = Object.keys(this.results.financial_summary[metric]).sort().reverse();
                    return years.length > 0 ? this.results.financial_summary[metric][years[0]] : 0;
                },

                filteredDocuments() {
                    if (!this.results?.documents) return [];
                    if (this.documentFilter === 'all') return this.results.documents;
                    
                    return this.results.documents.filter(doc => {
                        const title = doc.title.toLowerCase();
                        switch (this.documentFilter) {
                            case 'annual': return title.includes('annual');
                            case 'quarterly': return title.includes('quarter');
                            case 'audit': return title.includes('audit');
                            default: return true;
                        }
                    });
                },

                initCharts() {
                    // Ownership Chart
                    const ownershipCtx = document.getElementById('ownershipChart');
                    if (ownershipCtx && this.results?.major_shareholders) {
                        const labels = this.results.major_shareholders.map(s => s.name);
                        const data = this.results.major_shareholders.map(s => {
                            const match = s.ownership.match(/(\d+)/);
                            return match ? parseInt(match[1]) : 0;
                        });
                        
                        new Chart(ownershipCtx, {
                            type: 'doughnut',
                            data: {
                                labels: labels,
                                datasets: [{
                                    data: data,
                                    backgroundColor: [
                                        'rgba(16, 185, 129, 0.8)',
                                        'rgba(59, 130, 246, 0.8)',
                                        'rgba(139, 92, 246, 0.8)',
                                        'rgba(236, 72, 153, 0.8)',
                                        'rgba(251, 191, 36, 0.8)'
                                    ]
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'right',
                                        labels: { color: '#e2e8f0' }
                                    }
                                }
                            }
                        });
                    }

                    // Revenue Chart
                    const revenueCtx = document.getElementById('revenueChart');
                    if (revenueCtx && this.results?.financial_summary) {
                        const years = Object.keys(this.results.financial_summary.revenue || {}).sort();
                        const revenue = years.map(y => this.results.financial_summary.revenue[y] / 1000000);
                        const profit = years.map(y => this.results.financial_summary.profit[y] / 1000000);
                        
                        new Chart(revenueCtx, {
                            type: 'line',
                            data: {
                                labels: years,
                                datasets: [{
                                    label: 'Revenue',
                                    data: revenue,
                                    borderColor: 'rgba(16, 185, 129, 1)',
                                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                    tension: 0.4
                                }, {
                                    label: 'Profit',
                                    data: profit,
                                    borderColor: 'rgba(59, 130, 246, 1)',
                                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                    tension: 0.4
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        labels: { color: '#e2e8f0' }
                                    }
                                },
                                scales: {
                                    y: {
                                        grid: { color: 'rgba(148, 163, 184, 0.1)' },
                                        ticks: { color: '#e2e8f0' }
                                    },
                                    x: {
                                        grid: { color: 'rgba(148, 163, 184, 0.1)' },
                                        ticks: { color: '#e2e8f0' }
                                    }
                                }
                            }
                        });
                    }

                    // Asset Chart
                    const assetCtx = document.getElementById('assetChart');
                    if (assetCtx && this.results?.financial_summary?.assets) {
                        const years = Object.keys(this.results.financial_summary.assets).sort();
                        const assets = years.map(y => this.results.financial_summary.assets[y] / 1000000);
                        
                        new Chart(assetCtx, {
                            type: 'bar',
                            data: {
                                labels: years,
                                datasets: [{
                                    label: 'Total Assets',
                                    data: assets,
                                    backgroundColor: 'rgba(139, 92, 246, 0.8)'
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: { display: false }
                                },
                                scales: {
                                    y: {
                                        grid: { color: 'rgba(148, 163, 184, 0.1)' },
                                        ticks: { color: '#e2e8f0' }
                                    },
                                    x: {
                                        grid: { color: 'rgba(148, 163, 184, 0.1)' },
                                        ticks: { color: '#e2e8f0' }
                                    }
                                }
                            }
                        });
                    }
                },

                initOrgChart() {
                    const chartDom = document.getElementById('orgChart');
                    if (chartDom && this.results) {
                        const myChart = echarts.init(chartDom);
                        
                        const data = {
                            name: this.results.company_name,
                            value: 'Parent Company',
                            children: this.results.subsidiaries?.map(sub => ({
                                name: sub.name,
                                value: sub.ownership
                            })) || []
                        };

                        const option = {
                            tooltip: {
                                trigger: 'item',
                                triggerOn: 'mousemove'
                            },
                            series: [{
                                type: 'tree',
                                data: [data],
                                top: '10%',
                                left: '10%',
                                bottom: '10%',
                                right: '20%',
                                symbolSize: 12,
                                label: {
                                    position: 'left',
                                    verticalAlign: 'middle',
                                    align: 'right',
                                    fontSize: 14,
                                    color: '#e2e8f0'
                                },
                                leaves: {
                                    label: {
                                        position: 'right',
                                        verticalAlign: 'middle',
                                        align: 'left'
                                    }
                                },
                                emphasis: {
                                    focus: 'descendant'
                                },
                                expandAndCollapse: true,
                                animationDuration: 550,
                                animationDurationUpdate: 750,
                                lineStyle: {
                                    color: '#4b5563',
                                    width: 2
                                },
                                itemStyle: {
                                    color: '#10b981',
                                    borderColor: '#10b981'
                                }
                            }]
                        };

                        myChart.setOption(option);
                    }
                },

                clearSearchResults() {
                    this.searchResults = null;
                    this.searchForm = {
                        company: '',
                        registry_id: ''
                    };
                },

                addToWatchlist() {
                    alert('Added to watchlist for monitoring');
                },

                downloadProfile() {
                    alert('Downloading company profile...');
                },

                generateReport() {
                    alert('Generating comprehensive report...');
                },

                compareCompanies() {
                    alert('Company comparison feature coming soon');
                },

                shareProfile() {
                    alert('Share functionality coming soon');
                },

                newSearch() {
                    this.results = null;
                    this.searchResults = null;
                    this.searchForm = {
                        company: '',
                        registry_id: ''
                    };
                    this.searchOptions = {
                        includeInactive: false,
                        includeSubsidiaries: false
                    };
                }
            };
        }
    </script>
</body>
</html>