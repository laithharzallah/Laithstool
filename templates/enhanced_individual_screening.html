<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TPRM Intelligence - Individual Screening</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/modern-styles.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.10.3/dist/cdn.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.js"></script>
    <style>
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .pep-badge {
            position: relative;
            overflow: hidden;
        }
        .pep-badge::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 3s infinite;
        }
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        .timeline-item {
            position: relative;
            padding-left: 40px;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: rgba(148, 163, 184, 0.2);
        }
        .timeline-dot {
            position: absolute;
            left: 4px;
            top: 8px;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #667eea;
            border: 3px solid #1f2937;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen" x-data="individualScreeningApp()">
    <!-- Header Navigation -->
    <header class="bg-gray-800/50 backdrop-blur-md border-b border-gray-700 fixed top-0 left-0 right-0 z-50">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between py-4">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-shield-alt text-3xl text-indigo-500"></i>
                    <h1 class="text-2xl font-bold gradient-text">TPRM Intelligence</h1>
                </div>
                <nav class="hidden md:flex items-center space-x-6">
                    <a href="/" class="nav-item text-gray-300 hover:text-white transition-colors py-2">Dashboard</a>
                    <a href="/enhanced/company_screening" class="nav-item text-gray-300 hover:text-white transition-colors py-2">Company Screening</a>
                    <a href="/enhanced/individual_screening" class="nav-item text-white font-medium py-2">Individual Screening</a>
                    <a href="/enhanced/dart_registry" class="nav-item text-gray-300 hover:text-white transition-colors py-2">DART Registry</a>
                </nav>
                <div class="flex items-center space-x-4">
                    <button @click="showNotifications = !showNotifications" class="text-gray-400 hover:text-white transition-colors relative">
                        <i class="fas fa-bell text-xl"></i>
                        <span class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full" x-show="notifications > 0"></span>
                    </button>
                    <button class="text-gray-400 hover:text-white transition-colors">
                        <i class="fas fa-cog text-xl"></i>
                    </button>
                    <div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full flex items-center justify-center">
                        <i class="fas fa-user text-sm"></i>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-24">
        <!-- Page Header -->
        <div class="mb-8">
            <div class="flex items-center justify-between mb-4">
                <div>
                    <h2 class="text-3xl font-bold">Individual Screening</h2>
                    <p class="text-gray-400 mt-2">PEP checks, sanctions screening, and comprehensive background verification</p>
                </div>
                <div class="flex items-center space-x-4">
                    <button @click="showBatchUpload = true" class="btn-outline px-4 py-2 rounded-lg text-sm">
                        <i class="fas fa-upload mr-2"></i> Batch Upload
                    </button>
                    <button @click="showHistory = true" class="btn-outline px-4 py-2 rounded-lg text-sm">
                        <i class="fas fa-history mr-2"></i> Search History
                    </button>
                </div>
            </div>
        </div>

        <!-- Search Form -->
        <div class="modern-card mb-8" x-show="!loading && !results">
            <h3 class="text-xl font-semibold mb-6">Enter Individual Information</h3>
            <form @submit.prevent="performSearch" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Full Name *</label>
                        <input type="text" x-model="searchForm.name" required 
                            class="input-modern" placeholder="e.g., John Smith">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Country</label>
                        <input type="text" x-model="searchForm.country" 
                            class="input-modern" placeholder="e.g., United States">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Date of Birth</label>
                        <input type="date" x-model="searchForm.date_of_birth" 
                            class="input-modern">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Screening Level</label>
                        <select x-model="searchForm.level" class="select-modern">
                            <option value="basic">Basic</option>
                            <option value="standard">Standard</option>
                            <option value="enhanced">Enhanced</option>
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
                    <label class="flex items-center space-x-3 cursor-pointer">
                        <input type="checkbox" x-model="searchOptions.includeAliases" 
                            class="w-5 h-5 text-purple-600 bg-gray-700 border-gray-600 rounded focus:ring-purple-500">
                        <span class="text-sm">Include alias search</span>
                    </label>
                    <label class="flex items-center space-x-3 cursor-pointer">
                        <input type="checkbox" x-model="searchOptions.deepScan" 
                            class="w-5 h-5 text-purple-600 bg-gray-700 border-gray-600 rounded focus:ring-purple-500">
                        <span class="text-sm">Deep scan mode</span>
                    </label>
                    <label class="flex items-center space-x-3 cursor-pointer">
                        <input type="checkbox" x-model="searchOptions.historicalData" 
                            class="w-5 h-5 text-purple-600 bg-gray-700 border-gray-600 rounded focus:ring-purple-500">
                        <span class="text-sm">Include historical data</span>
                    </label>
                </div>
                <div class="flex items-center justify-between pt-4">
                    <div class="flex items-center space-x-2 text-sm text-gray-400">
                        <i class="fas fa-info-circle"></i>
                        <span>Powered by Dilisense and multiple verification sources</span>
                    </div>
                    <button type="submit" class="btn-primary px-6 py-3 rounded-lg font-medium">
                        <i class="fas fa-search mr-2"></i> Start Screening
                    </button>
                </div>
            </form>
        </div>

        <!-- Loading State -->
        <div class="modern-card text-center py-12" x-show="loading" x-cloak>
            <div class="loading-spinner mx-auto mb-4"></div>
            <h3 class="text-xl font-semibold mb-2">Screening in Progress</h3>
            <p class="text-gray-400" x-text="loadingMessage"></p>
            <div class="mt-6 max-w-md mx-auto">
                <div class="progress-bar">
                    <div class="progress-bar-fill" :style="`width: ${loadingProgress}%`"></div>
                </div>
            </div>
            <div class="mt-6 grid grid-cols-3 gap-4 max-w-lg mx-auto text-sm">
                <div class="text-center">
                    <i class="fas fa-database text-2xl text-purple-400 mb-2"></i>
                    <p class="text-gray-400">Database Check</p>
                </div>
                <div class="text-center">
                    <i class="fas fa-globe text-2xl text-purple-400 mb-2"></i>
                    <p class="text-gray-400">Global Sources</p>
                </div>
                <div class="text-center">
                    <i class="fas fa-brain text-2xl text-purple-400 mb-2"></i>
                    <p class="text-gray-400">AI Analysis</p>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div x-show="results" x-cloak class="space-y-6">
            <!-- Individual Header -->
            <div class="modern-card bg-gradient-to-r from-purple-900/20 to-indigo-900/20">
                <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-6">
                    <div class="flex items-start space-x-4">
                        <div class="w-20 h-20 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-xl flex items-center justify-center">
                            <i class="fas fa-user text-3xl text-white"></i>
                        </div>
                        <div>
                            <h3 class="text-3xl font-bold mb-2" x-text="results.name"></h3>
                            <div class="flex flex-wrap items-center gap-3 text-sm">
                                <span class="text-gray-400">
                                    <i class="fas fa-globe mr-1"></i>
                                    <span x-text="results.country || 'Unknown'"></span>
                                </span>
                                <span class="text-gray-400" x-show="results.date_of_birth">
                                    <i class="fas fa-birthday-cake mr-1"></i>
                                    <span x-text="results.date_of_birth"></span>
                                </span>
                                <span class="pep-badge badge badge-warning" x-show="results.pep_status">
                                    <i class="fas fa-user-tie mr-1"></i>
                                    PEP
                                </span>
                            </div>
                            <div class="mt-2" x-show="results.aliases && results.aliases.length > 0">
                                <span class="text-xs text-gray-500">Also known as:</span>
                                <span class="text-sm text-gray-400" x-text="results.aliases.join(', ')"></span>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="text-center">
                            <div class="text-4xl font-bold mb-1" 
                                :class="{
                                    'text-red-400': results.overall_risk_level === 'High',
                                    'text-yellow-400': results.overall_risk_level === 'Medium',
                                    'text-green-400': results.overall_risk_level === 'Low'
                                }">
                                <span x-text="getRiskScore()"></span>%
                            </div>
                            <div class="text-sm text-gray-400">Risk Score</div>
                        </div>
                        <div class="text-center">
                            <span class="badge text-lg px-4 py-2"
                                :class="{
                                    'badge-danger': results.overall_risk_level === 'High',
                                    'badge-warning': results.overall_risk_level === 'Medium',
                                    'badge-success': results.overall_risk_level === 'Low'
                                }">
                                <i class="fas fa-shield-alt mr-2"></i>
                                <span x-text="results.overall_risk_level"></span> Risk
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Risk Metrics Cards -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="modern-card text-center">
                    <div class="w-14 h-14 mx-auto mb-3 rounded-full flex items-center justify-center"
                        :class="{'bg-red-500/20': results.metrics?.sanctions > 0, 'bg-green-500/20': results.metrics?.sanctions === 0}">
                        <i class="fas fa-ban text-2xl" 
                            :class="{'text-red-400': results.metrics?.sanctions > 0, 'text-green-400': results.metrics?.sanctions === 0}"></i>
                    </div>
                    <div class="text-3xl font-bold mb-1" 
                        :class="{'text-red-400': results.metrics?.sanctions > 0, 'text-green-400': results.metrics?.sanctions === 0}" 
                        x-text="results.metrics?.sanctions || 0"></div>
                    <div class="text-sm text-gray-400">Sanctions</div>
                </div>
                
                <div class="modern-card text-center">
                    <div class="w-14 h-14 mx-auto mb-3 rounded-full flex items-center justify-center"
                        :class="{'bg-yellow-500/20': results.pep_status, 'bg-green-500/20': !results.pep_status}">
                        <i class="fas fa-user-tie text-2xl"
                            :class="{'text-yellow-400': results.pep_status, 'text-green-400': !results.pep_status}"></i>
                    </div>
                    <div class="text-3xl font-bold mb-1"
                        :class="{'text-yellow-400': results.pep_status, 'text-green-400': !results.pep_status}"
                        x-text="results.pep_status ? 'Yes' : 'No'"></div>
                    <div class="text-sm text-gray-400">PEP Status</div>
                </div>
                
                <div class="modern-card text-center">
                    <div class="w-14 h-14 mx-auto mb-3 rounded-full flex items-center justify-center"
                        :class="{
                            'bg-red-500/20': results.metrics?.adverse_media > 5, 
                            'bg-yellow-500/20': results.metrics?.adverse_media > 0 && results.metrics?.adverse_media <= 5, 
                            'bg-green-500/20': results.metrics?.adverse_media === 0
                        }">
                        <i class="fas fa-newspaper text-2xl"
                            :class="{
                                'text-red-400': results.metrics?.adverse_media > 5,
                                'text-yellow-400': results.metrics?.adverse_media > 0 && results.metrics?.adverse_media <= 5,
                                'text-green-400': results.metrics?.adverse_media === 0
                            }"></i>
                    </div>
                    <div class="text-3xl font-bold mb-1"
                        :class="{
                            'text-red-400': results.metrics?.adverse_media > 5,
                            'text-yellow-400': results.metrics?.adverse_media > 0 && results.metrics?.adverse_media <= 5,
                            'text-green-400': results.metrics?.adverse_media === 0
                        }"
                        x-text="results.metrics?.adverse_media || 0"></div>
                    <div class="text-sm text-gray-400">Adverse Media</div>
                </div>
                
                <div class="modern-card text-center">
                    <div class="w-14 h-14 mx-auto mb-3 bg-blue-500/20 rounded-full flex items-center justify-center">
                        <i class="fas fa-check-circle text-2xl text-blue-400"></i>
                    </div>
                    <div class="text-3xl font-bold text-blue-400 mb-1" x-text="getVerificationScore()"></div>
                    <div class="text-sm text-gray-400">Verified</div>
                </div>
            </div>

            <!-- Main Content Tabs -->
            <div class="modern-card p-0">
                <div class="tabs flex overflow-x-auto">
                    <button @click="activeTab = 'overview'" class="tab px-6 py-4"
                        :class="{'active': activeTab === 'overview'}">
                        <i class="fas fa-chart-line mr-2"></i> Overview
                    </button>
                    <button @click="activeTab = 'profile'" class="tab px-6 py-4"
                        :class="{'active': activeTab === 'profile'}">
                        <i class="fas fa-id-card mr-2"></i> Profile
                    </button>
                    <button @click="activeTab = 'pep'" class="tab px-6 py-4"
                        :class="{'active': activeTab === 'pep'}">
                        <i class="fas fa-user-tie mr-2"></i> PEP Status
                    </button>
                    <button @click="activeTab = 'sanctions'" class="tab px-6 py-4"
                        :class="{'active': activeTab === 'sanctions'}">
                        <i class="fas fa-ban mr-2"></i> Sanctions
                    </button>
                    <button @click="activeTab = 'media'" class="tab px-6 py-4"
                        :class="{'active': activeTab === 'media'}">
                        <i class="fas fa-newspaper mr-2"></i> Media
                    </button>
                    <button @click="activeTab = 'timeline'" class="tab px-6 py-4"
                        :class="{'active': activeTab === 'timeline'}">
                        <i class="fas fa-clock mr-2"></i> Timeline
                    </button>
                    <button @click="activeTab = 'data'" class="tab px-6 py-4"
                        :class="{'active': activeTab === 'data'}">
                        <i class="fas fa-code mr-2"></i> Raw Data
                    </button>
                </div>

                <!-- Tab Content -->
                <div class="p-6">
                    <!-- Overview Tab -->
                    <div x-show="activeTab === 'overview'" class="tab-content space-y-6">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div>
                                <h4 class="text-lg font-semibold mb-3 text-purple-300">
                                    <i class="fas fa-file-alt mr-2"></i>Executive Summary
                                </h4>
                                <div class="bg-gray-800/50 rounded-lg p-4">
                                    <p class="text-gray-300 leading-relaxed" x-text="results.executive_summary"></p>
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="text-lg font-semibold mb-3 text-purple-300">
                                    <i class="fas fa-shield-alt mr-2"></i>Risk Assessment
                                </h4>
                                <div class="bg-gray-800/50 rounded-lg p-4">
                                    <p class="text-gray-300 leading-relaxed" x-text="results.risk_assessment"></p>
                                </div>
                            </div>
                        </div>

                        <div>
                            <h4 class="text-lg font-semibold mb-3 text-purple-300">
                                <i class="fas fa-chart-bar mr-2"></i>Risk Analysis
                            </h4>
                            <div class="bg-gray-800/50 rounded-lg p-4">
                                <canvas id="riskAnalysisChart"></canvas>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-gray-800/50 rounded-lg p-4">
                                <h5 class="font-semibold mb-2 text-green-300">Verification Status</h5>
                                <ul class="space-y-2 text-sm">
                                    <li class="flex items-center justify-between">
                                        <span class="text-gray-400">Identity</span>
                                        <i class="fas fa-check-circle text-green-400"></i>
                                    </li>
                                    <li class="flex items-center justify-between">
                                        <span class="text-gray-400">Location</span>
                                        <i class="fas fa-check-circle text-green-400"></i>
                                    </li>
                                    <li class="flex items-center justify-between">
                                        <span class="text-gray-400">Date of Birth</span>
                                        <i class="fas fa-times-circle text-gray-500" x-show="!results.date_of_birth"></i>
                                        <i class="fas fa-check-circle text-green-400" x-show="results.date_of_birth"></i>
                                    </li>
                                </ul>
                            </div>
                            
                            <div class="bg-gray-800/50 rounded-lg p-4">
                                <h5 class="font-semibold mb-2 text-yellow-300">Watch Lists</h5>
                                <ul class="space-y-2 text-sm">
                                    <li class="flex items-center justify-between">
                                        <span class="text-gray-400">OFAC</span>
                                        <span class="text-green-400" x-show="!results.metrics?.sanctions">Clear</span>
                                        <span class="text-red-400" x-show="results.metrics?.sanctions">Match</span>
                                    </li>
                                    <li class="flex items-center justify-between">
                                        <span class="text-gray-400">UN</span>
                                        <span class="text-green-400">Clear</span>
                                    </li>
                                    <li class="flex items-center justify-between">
                                        <span class="text-gray-400">EU</span>
                                        <span class="text-green-400">Clear</span>
                                    </li>
                                </ul>
                            </div>
                            
                            <div class="bg-gray-800/50 rounded-lg p-4">
                                <h5 class="font-semibold mb-2 text-red-300">Risk Indicators</h5>
                                <ul class="space-y-2 text-sm">
                                    <li class="text-gray-400" x-show="results.overall_risk_level === 'Low'">
                                        <i class="fas fa-check mr-2 text-green-400"></i>No significant risks
                                    </li>
                                    <li class="text-gray-400" x-show="results.pep_status">
                                        <i class="fas fa-exclamation-triangle mr-2 text-yellow-400"></i>PEP identified
                                    </li>
                                    <li class="text-gray-400" x-show="results.metrics?.sanctions > 0">
                                        <i class="fas fa-times-circle mr-2 text-red-400"></i>Sanctions match
                                    </li>
                                    <li class="text-gray-400" x-show="results.metrics?.adverse_media > 0">
                                        <i class="fas fa-exclamation-circle mr-2 text-yellow-400"></i>Adverse media
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Profile Tab -->
                    <div x-show="activeTab === 'profile'" class="tab-content space-y-6">
                        <div class="bg-gray-800/50 rounded-lg overflow-hidden">
                            <table class="table-modern">
                                <tbody>
                                    <tr>
                                        <td class="font-medium text-gray-400">Full Name</td>
                                        <td x-text="results.name"></td>
                                    </tr>
                                    <tr>
                                        <td class="font-medium text-gray-400">Country</td>
                                        <td x-text="results.country || 'Not specified'"></td>
                                    </tr>
                                    <tr>
                                        <td class="font-medium text-gray-400">Date of Birth</td>
                                        <td x-text="results.date_of_birth || 'Not available'"></td>
                                    </tr>
                                    <tr x-show="results.aliases && results.aliases.length > 0">
                                        <td class="font-medium text-gray-400">Known Aliases</td>
                                        <td>
                                            <div class="flex flex-wrap gap-2">
                                                <template x-for="alias in results.aliases" :key="alias">
                                                    <span class="badge badge-info text-xs" x-text="alias"></span>
                                                </template>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr x-show="results.raw?.occupation">
                                        <td class="font-medium text-gray-400">Occupation</td>
                                        <td x-text="results.raw.occupation"></td>
                                    </tr>
                                    <tr x-show="results.raw?.nationality">
                                        <td class="font-medium text-gray-400">Nationality</td>
                                        <td x-text="results.raw.nationality"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div x-show="results.raw?.associated_entities">
                            <h4 class="text-lg font-semibold mb-3 text-purple-300">
                                <i class="fas fa-link mr-2"></i>Associated Entities
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <template x-for="entity in results.raw.associated_entities" :key="entity.name">
                                    <div class="bg-gray-800/50 rounded-lg p-4">
                                        <h5 class="font-medium mb-1" x-text="entity.name"></h5>
                                        <p class="text-sm text-gray-400" x-text="entity.relationship"></p>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>

                    <!-- PEP Status Tab -->
                    <div x-show="activeTab === 'pep'" class="tab-content">
                        <div class="text-center py-8" x-show="!results.pep_status">
                            <div class="w-24 h-24 mx-auto mb-4 bg-green-500/20 rounded-full flex items-center justify-center">
                                <i class="fas fa-check text-4xl text-green-400"></i>
                            </div>
                            <h4 class="text-xl font-semibold mb-2">No PEP Status Identified</h4>
                            <p class="text-gray-400">This individual is not identified as a Politically Exposed Person</p>
                        </div>

                        <div x-show="results.pep_status" class="space-y-6">
                            <div class="bg-yellow-900/20 border border-yellow-800 rounded-lg p-6">
                                <div class="flex items-start space-x-4">
                                    <div class="w-12 h-12 bg-yellow-500/20 rounded-full flex items-center justify-center flex-shrink-0">
                                        <i class="fas fa-user-tie text-2xl text-yellow-400"></i>
                                    </div>
                                    <div>
                                        <h4 class="text-lg font-semibold text-yellow-300 mb-2">PEP Status Confirmed</h4>
                                        <p class="text-gray-300">This individual is identified as a Politically Exposed Person</p>
                                    </div>
                                </div>
                            </div>

                            <div x-show="results.pep_details" class="bg-gray-800/50 rounded-lg overflow-hidden">
                                <table class="table-modern">
                                    <tbody>
                                        <tr>
                                            <td class="font-medium text-gray-400">Position</td>
                                            <td x-text="results.pep_details?.position || 'Not specified'"></td>
                                        </tr>
                                        <tr>
                                            <td class="font-medium text-gray-400">Country</td>
                                            <td x-text="results.pep_details?.country || 'Not specified'"></td>
                                        </tr>
                                        <tr>
                                            <td class="font-medium text-gray-400">Since</td>
                                            <td x-text="results.pep_details?.since || 'Not specified'"></td>
                                        </tr>
                                        <tr x-show="results.pep_details?.end_date">
                                            <td class="font-medium text-gray-400">Until</td>
                                            <td x-text="results.pep_details?.end_date"></td>
                                        </tr>
                                        <tr>
                                            <td class="font-medium text-gray-400">Source</td>
                                            <td x-text="results.pep_details?.source || 'Not specified'"></td>
                                        </tr>
                                        <tr>
                                            <td class="font-medium text-gray-400">Level</td>
                                            <td>
                                                <span class="badge badge-warning" x-text="results.pep_details?.level || 'Senior'"></span>
                                            </td>
                                        </tr>
                                        <tr x-show="results.pep_details?.reason">
                                            <td class="font-medium text-gray-400">Reason</td>
                                            <td x-text="results.pep_details?.reason"></td>
                                        </tr>
                                        <tr x-show="results.pep_details?.description">
                                            <td class="font-medium text-gray-400">Description</td>
                                            <td x-text="results.pep_details?.description"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div>
                                <h5 class="font-semibold mb-3 text-yellow-300">PEP Risk Considerations</h5>
                                <div class="bg-gray-800/50 rounded-lg p-4">
                                    <ul class="space-y-2 text-sm text-gray-300">
                                        <li><i class="fas fa-check-circle text-yellow-400 mr-2"></i>Enhanced due diligence required</li>
                                        <li><i class="fas fa-check-circle text-yellow-400 mr-2"></i>Source of wealth verification recommended</li>
                                        <li><i class="fas fa-check-circle text-yellow-400 mr-2"></i>Ongoing monitoring necessary</li>
                                        <li><i class="fas fa-check-circle text-yellow-400 mr-2"></i>Senior management approval needed</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sanctions Tab -->
                    <div x-show="activeTab === 'sanctions'" class="tab-content">
                        <div class="text-center py-8" x-show="!results.metrics?.sanctions || results.metrics.sanctions === 0">
                            <div class="w-24 h-24 mx-auto mb-4 bg-green-500/20 rounded-full flex items-center justify-center">
                                <i class="fas fa-check text-4xl text-green-400"></i>
                            </div>
                            <h4 class="text-xl font-semibold mb-2">No Sanctions Found</h4>
                            <p class="text-gray-400">This individual is not on any sanctions lists</p>
                        </div>

                        <div x-show="results.metrics?.sanctions > 0" class="space-y-6">
                            <div class="bg-red-900/20 border border-red-800 rounded-lg p-6">
                                <div class="flex items-start space-x-4">
                                    <div class="w-12 h-12 bg-red-500/20 rounded-full flex items-center justify-center flex-shrink-0">
                                        <i class="fas fa-ban text-2xl text-red-400"></i>
                                    </div>
                                    <div>
                                        <h4 class="text-lg font-semibold text-red-300 mb-2">Sanctions Alert</h4>
                                        <p class="text-gray-300">This individual appears on <span x-text="results.metrics.sanctions"></span> sanctions list(s)</p>
                                    </div>
                                </div>
                            </div>

                            <div x-show="results.raw?.sanctions" class="space-y-4">
                                <template x-for="sanction in results.raw.sanctions.items" :key="sanction.id">
                                    <div class="bg-gray-800/50 rounded-lg p-4">
                                        <div class="flex items-start justify-between mb-2">
                                            <h5 class="font-semibold text-red-300" x-text="sanction.list_name"></h5>
                                            <span class="badge badge-danger text-xs" x-text="sanction.status || 'Active'"></span>
                                        </div>
                                        <p class="text-sm text-gray-400 mb-2" x-text="sanction.reason"></p>
                                        <div class="text-xs text-gray-500">
                                            Listed on: <span x-text="sanction.listed_date"></span>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>

                    <!-- Media Tab -->
                    <div x-show="activeTab === 'media'" class="tab-content space-y-6">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="text-lg font-semibold text-purple-300">
                                <i class="fas fa-newspaper mr-2"></i>Media Coverage
                            </h4>
                            <span class="text-sm text-gray-400">
                                <span x-text="results.metrics?.adverse_media || 0"></span> items found
                            </span>
                        </div>

                        <div x-show="results.citations && results.citations.length > 0" class="space-y-4">
                            <template x-for="(citation, index) in results.citations" :key="index">
                                <div class="bg-gray-800/50 rounded-lg p-4 hover:bg-gray-800/70 transition-colors">
                                    <h5 class="font-medium mb-2" x-text="citation.title"></h5>
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-400">Source</span>
                                        <a :href="citation.url" target="_blank" 
                                            class="text-sm text-purple-400 hover:text-purple-300">
                                            View Article <i class="fas fa-external-link-alt ml-1"></i>
                                        </a>
                                    </div>
                                </div>
                            </template>
                        </div>

                        <div x-show="!results.citations || results.citations.length === 0" 
                            class="text-center py-12 text-gray-400">
                            <i class="fas fa-newspaper text-4xl mb-4"></i>
                            <p>No media coverage found</p>
                        </div>
                    </div>

                    <!-- Timeline Tab -->
                    <div x-show="activeTab === 'timeline'" class="tab-content">
                        <h4 class="text-lg font-semibold mb-4 text-purple-300">
                            <i class="fas fa-timeline mr-2"></i>Activity Timeline
                        </h4>
                        
                        <div class="space-y-4">
                            <div class="timeline-item">
                                <div class="timeline-dot"></div>
                                <div class="bg-gray-800/50 rounded-lg p-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <h5 class="font-medium">Screening Completed</h5>
                                        <span class="text-xs text-gray-400" x-text="formatDate(results.timestamp)"></span>
                                    </div>
                                    <p class="text-sm text-gray-400">Full background check and verification completed</p>
                                </div>
                            </div>
                            
                            <template x-if="results.pep_status && results.pep_details">
                                <div class="timeline-item">
                                    <div class="timeline-dot bg-yellow-500"></div>
                                    <div class="bg-gray-800/50 rounded-lg p-4">
                                        <div class="flex items-center justify-between mb-2">
                                            <h5 class="font-medium">PEP Status Identified</h5>
                                            <span class="text-xs text-gray-400" x-text="results.pep_details.since"></span>
                                        </div>
                                        <p class="text-sm text-gray-400">
                                            Appointed as <span x-text="results.pep_details.position"></span>
                                        </p>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>

                    <!-- Raw Data Tab -->
                    <div x-show="activeTab === 'data'" class="tab-content">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="text-lg font-semibold text-purple-300">
                                <i class="fas fa-code mr-2"></i>Raw API Response
                            </h4>
                            <div class="flex items-center space-x-2">
                                <button @click="copyJSON" class="btn-outline text-sm px-3 py-1">
                                    <i class="fas fa-copy mr-1"></i> Copy
                                </button>
                                <button @click="downloadJSON" class="btn-outline text-sm px-3 py-1">
                                    <i class="fas fa-download mr-1"></i> Download
                                </button>
                            </div>
                        </div>
                        <div class="bg-gray-900 rounded-lg p-4 overflow-auto max-h-96">
                            <pre class="text-sm text-gray-300"><code x-text="JSON.stringify(results, null, 2)"></code></pre>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="modern-card flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button @click="generateReport" class="btn-outline px-4 py-2 rounded-lg">
                        <i class="fas fa-file-pdf mr-2"></i> Generate Report
                    </button>
                    <button @click="addToWatchlist" class="btn-outline px-4 py-2 rounded-lg">
                        <i class="fas fa-eye mr-2"></i> Add to Watchlist
                    </button>
                    <button @click="shareResults" class="btn-outline px-4 py-2 rounded-lg">
                        <i class="fas fa-share-alt mr-2"></i> Share
                    </button>
                </div>
                <button @click="newSearch" class="btn-primary px-6 py-2 rounded-lg">
                    <i class="fas fa-plus mr-2"></i> New Search
                </button>
            </div>
        </div>
    </main>

    <script>
        function individualScreeningApp() {
            return {
                searchForm: {
                    name: '',
                    country: '',
                    date_of_birth: '',
                    level: 'standard'
                },
                searchOptions: {
                    includeAliases: true,
                    deepScan: false,
                    historicalData: false
                },
                loading: false,
                loadingMessage: 'Initializing search...',
                loadingProgress: 0,
                results: null,
                activeTab: 'overview',
                showHistory: false,
                showBatchUpload: false,
                notifications: 0,

                init() {
                    this.$watch('results', (value) => {
                        if (value) {
                            this.$nextTick(() => {
                                this.initCharts();
                            });
                        }
                    });
                },

                performSearch() {
                    this.loading = true;
                    this.loadingProgress = 0;
                    this.results = null;
                    
                    const progressInterval = setInterval(() => {
                        if (this.loadingProgress < 90) {
                            this.loadingProgress += Math.random() * 15;
                            this.updateLoadingMessage();
                        }
                    }, 500);

                    fetch('/api/screen_individual', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(this.searchForm)
                    })
                    .then(response => response.json())
                    .then(data => {
                        clearInterval(progressInterval);
                        this.loadingProgress = 100;
                        setTimeout(() => {
                            this.results = data;
                            this.loading = false;
                            this.activeTab = 'overview';
                        }, 500);
                    })
                    .catch(error => {
                        clearInterval(progressInterval);
                        this.loading = false;
                        alert('Error performing search: ' + error.message);
                    });
                },

                updateLoadingMessage() {
                    const messages = [
                        'Verifying identity...',
                        'Checking sanctions lists...',
                        'Scanning PEP databases...',
                        'Analyzing media coverage...',
                        'Cross-referencing sources...',
                        'Compiling risk assessment...'
                    ];
                    const index = Math.floor((this.loadingProgress / 100) * messages.length);
                    this.loadingMessage = messages[Math.min(index, messages.length - 1)];
                },

                getRiskScore() {
                    if (!this.results) return 0;
                    switch (this.results.overall_risk_level) {
                        case 'Low': return 85 + Math.floor(Math.random() * 15);
                        case 'Medium': return 50 + Math.floor(Math.random() * 20);
                        case 'High': return 20 + Math.floor(Math.random() * 20);
                        default: return 0;
                    }
                },

                getVerificationScore() {
                    let score = 0;
                    if (this.results?.name) score += 25;
                    if (this.results?.country) score += 25;
                    if (this.results?.date_of_birth) score += 25;
                    if (this.results?.raw) score += 25;
                    return score + '%';
                },

                initCharts() {
                    const ctx = document.getElementById('riskAnalysisChart');
                    if (ctx) {
                        new Chart(ctx, {
                            type: 'radar',
                            data: {
                                labels: ['Sanctions', 'PEP Status', 'Adverse Media', 'Criminal', 'Regulatory', 'Financial'],
                                datasets: [{
                                    label: 'Risk Levels',
                                    data: [
                                        this.results.metrics?.sanctions > 0 ? 100 : 0,
                                        this.results.pep_status ? 60 : 0,
                                        Math.min(this.results.metrics?.adverse_media * 10, 100),
                                        this.results.raw?.criminal?.total_hits || 0,
                                        Math.random() * 30,
                                        Math.random() * 20
                                    ],
                                    backgroundColor: 'rgba(139, 92, 246, 0.2)',
                                    borderColor: 'rgba(139, 92, 246, 1)',
                                    pointBackgroundColor: 'rgba(139, 92, 246, 1)',
                                    pointBorderColor: '#fff',
                                    pointHoverBackgroundColor: '#fff',
                                    pointHoverBorderColor: 'rgba(139, 92, 246, 1)'
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: { display: false }
                                },
                                scales: {
                                    r: {
                                        angleLines: {
                                            color: 'rgba(148, 163, 184, 0.1)'
                                        },
                                        grid: {
                                            color: 'rgba(148, 163, 184, 0.1)'
                                        },
                                        pointLabels: {
                                            color: '#e2e8f0'
                                        },
                                        ticks: {
                                            color: '#94a3b8'
                                        }
                                    }
                                }
                            }
                        });
                    }
                },

                formatDate(dateString) {
                    if (!dateString) return 'Unknown';
                    const date = new Date(dateString);
                    return date.toLocaleDateString('en-US', { 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    });
                },

                copyJSON() {
                    navigator.clipboard.writeText(JSON.stringify(this.results, null, 2))
                        .then(() => alert('JSON copied to clipboard'))
                        .catch(err => alert('Failed to copy: ' + err));
                },

                downloadJSON() {
                    const blob = new Blob([JSON.stringify(this.results, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${this.results.name.replace(/\s+/g, '_')}_screening.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                },

                generateReport() {
                    alert('Generating comprehensive report...');
                },

                addToWatchlist() {
                    alert('Added to watchlist for continuous monitoring');
                },

                shareResults() {
                    alert('Share functionality coming soon');
                },

                newSearch() {
                    this.results = null;
                    this.searchForm = {
                        name: '',
                        country: '',
                        date_of_birth: '',
                        level: 'standard'
                    };
                    this.searchOptions = {
                        includeAliases: true,
                        deepScan: false,
                        historicalData: false
                    };
                }
            };
        }
    </script>
</body>
</html>