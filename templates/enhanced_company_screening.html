<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TPRM Intelligence - Company Screening</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/modern-styles.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.10.3/dist/cdn.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.js"></script>
    <style>
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .risk-card {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .risk-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }
        .risk-card:hover::before {
            left: 100%;
        }
        .tab-content {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen" x-data="companyScreeningApp()">
    <!-- Header Navigation -->
    <header class="bg-gray-800/50 backdrop-blur-md border-b border-gray-700 fixed top-0 left-0 right-0 z-50">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between py-4">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-shield-alt text-3xl text-indigo-500"></i>
                    <h1 class="text-2xl font-bold gradient-text">TPRM Intelligence</h1>
                </div>
                <nav class="hidden md:flex items-center space-x-6">
                    <a href="/" class="nav-item text-gray-300 hover:text-white transition-colors py-2">Dashboard</a>
                    <a href="/enhanced/company_screening" class="nav-item text-white font-medium py-2">Company Screening</a>
                    <a href="/enhanced/individual_screening" class="nav-item text-gray-300 hover:text-white transition-colors py-2">Individual Screening</a>
                    <a href="/enhanced/dart_registry" class="nav-item text-gray-300 hover:text-white transition-colors py-2">DART Registry</a>
                </nav>
                <div class="flex items-center space-x-4">
                    <button @click="showNotifications = !showNotifications" class="text-gray-400 hover:text-white transition-colors relative">
                        <i class="fas fa-bell text-xl"></i>
                        <span class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full"></span>
                    </button>
                    <button class="text-gray-400 hover:text-white transition-colors">
                        <i class="fas fa-cog text-xl"></i>
                    </button>
                    <div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full flex items-center justify-center">
                        <i class="fas fa-user text-sm"></i>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-24">
        <!-- Page Header -->
        <div class="mb-8">
            <div class="flex items-center justify-between mb-4">
                <div>
                    <h2 class="text-3xl font-bold">Company Screening</h2>
                    <p class="text-gray-400 mt-2">Comprehensive risk assessment with real-time data from multiple sources</p>
                </div>
                <div class="flex items-center space-x-4">
                    <button @click="showHistory = true" class="btn-outline px-4 py-2 rounded-lg text-sm">
                        <i class="fas fa-history mr-2"></i> Search History
                    </button>
                    <button @click="showSaved = true" class="btn-outline px-4 py-2 rounded-lg text-sm">
                        <i class="fas fa-bookmark mr-2"></i> Saved Searches
                    </button>
                </div>
            </div>
        </div>

        <!-- Search Form -->
        <div class="modern-card mb-8" x-show="!loading && !results">
            <h3 class="text-xl font-semibold mb-6">Enter Company Information</h3>
            <form @submit.prevent="performSearch" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Company Name *</label>
                        <input type="text" x-model="searchForm.company" required 
                            class="input-modern" placeholder="e.g., Samsung Electronics">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Country</label>
                        <input type="text" x-model="searchForm.country" 
                            class="input-modern" placeholder="e.g., South Korea">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Domain</label>
                        <input type="text" x-model="searchForm.domain" 
                            class="input-modern" placeholder="e.g., samsung.com">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Screening Level</label>
                        <select x-model="searchForm.level" class="select-modern">
                            <option value="basic">Basic</option>
                            <option value="standard">Standard</option>
                            <option value="enhanced">Enhanced</option>
                        </select>
                    </div>
                </div>
                <div class="flex items-center justify-between pt-4">
                    <div class="flex items-center space-x-2 text-sm text-gray-400">
                        <i class="fas fa-info-circle"></i>
                        <span>Powered by Google CSE, OpenAI, and real-time data sources</span>
                    </div>
                    <button type="submit" class="btn-primary px-6 py-3 rounded-lg font-medium">
                        <i class="fas fa-search mr-2"></i> Start Screening
                    </button>
                </div>
            </form>
        </div>

        <!-- Loading State -->
        <div class="modern-card text-center py-12" x-show="loading" x-cloak>
            <div class="loading-spinner mx-auto mb-4"></div>
            <h3 class="text-xl font-semibold mb-2">Screening in Progress</h3>
            <p class="text-gray-400" x-text="loadingMessage"></p>
            <div class="mt-6 max-w-md mx-auto">
                <div class="progress-bar">
                    <div class="progress-bar-fill" :style="`width: ${loadingProgress}%`"></div>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div x-show="results" x-cloak class="space-y-6">
            <!-- Company Header -->
            <div class="modern-card bg-gradient-to-r from-gray-800 to-gray-900">
                <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-6">
                    <div class="flex items-start space-x-4">
                        <div class="w-20 h-20 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center">
                            <i class="fas fa-building text-3xl text-white"></i>
                        </div>
                        <div>
                            <h3 class="text-3xl font-bold mb-2" x-text="results.company_name"></h3>
                            <div class="flex flex-wrap items-center gap-3 text-sm">
                                <span class="text-gray-400">
                                    <i class="fas fa-globe mr-1"></i>
                                    <span x-text="results.country || 'Global'"></span>
                                </span>
                                <span class="text-gray-400" x-show="results.industry">
                                    <i class="fas fa-industry mr-1"></i>
                                    <span x-text="results.industry"></span>
                                </span>
                                <span class="text-gray-400" x-show="results.founded_year">
                                    <i class="fas fa-calendar mr-1"></i>
                                    Founded <span x-text="results.founded_year"></span>
                                </span>
                                <a :href="results.website" target="_blank" class="text-blue-400 hover:text-blue-300" x-show="results.website">
                                    <i class="fas fa-external-link-alt mr-1"></i>
                                    Website
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="text-center">
                            <div class="text-4xl font-bold mb-1" 
                                :class="{
                                    'text-red-400': results.overall_risk_level === 'High',
                                    'text-yellow-400': results.overall_risk_level === 'Medium',
                                    'text-green-400': results.overall_risk_level === 'Low'
                                }">
                                <span x-text="getRiskScore()"></span>%
                            </div>
                            <div class="text-sm text-gray-400">Risk Score</div>
                        </div>
                        <div class="text-center">
                            <span class="badge text-lg px-4 py-2"
                                :class="{
                                    'badge-danger': results.overall_risk_level === 'High',
                                    'badge-warning': results.overall_risk_level === 'Medium',
                                    'badge-success': results.overall_risk_level === 'Low'
                                }">
                                <i class="fas fa-shield-alt mr-2"></i>
                                <span x-text="results.overall_risk_level"></span> Risk
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Risk Metrics Cards -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="risk-card modern-card text-center">
                    <div class="w-14 h-14 mx-auto mb-3 rounded-full flex items-center justify-center"
                        :class="{'bg-red-500/20': results.metrics?.sanctions > 0, 'bg-green-500/20': results.metrics?.sanctions === 0}">
                        <i class="fas fa-ban text-2xl" 
                            :class="{'text-red-400': results.metrics?.sanctions > 0, 'text-green-400': results.metrics?.sanctions === 0}"></i>
                    </div>
                    <div class="text-3xl font-bold mb-1" 
                        :class="{'text-red-400': results.metrics?.sanctions > 0, 'text-green-400': results.metrics?.sanctions === 0}" 
                        x-text="results.metrics?.sanctions || 0"></div>
                    <div class="text-sm text-gray-400">Sanctions</div>
                </div>
                
                <div class="risk-card modern-card text-center">
                    <div class="w-14 h-14 mx-auto mb-3 rounded-full flex items-center justify-center"
                        :class="{
                            'bg-red-500/20': results.metrics?.adverse_media > 5, 
                            'bg-yellow-500/20': results.metrics?.adverse_media > 0 && results.metrics?.adverse_media <= 5, 
                            'bg-green-500/20': results.metrics?.adverse_media === 0
                        }">
                        <i class="fas fa-newspaper text-2xl"
                            :class="{
                                'text-red-400': results.metrics?.adverse_media > 5,
                                'text-yellow-400': results.metrics?.adverse_media > 0 && results.metrics?.adverse_media <= 5,
                                'text-green-400': results.metrics?.adverse_media === 0
                            }"></i>
                    </div>
                    <div class="text-3xl font-bold mb-1"
                        :class="{
                            'text-red-400': results.metrics?.adverse_media > 5,
                            'text-yellow-400': results.metrics?.adverse_media > 0 && results.metrics?.adverse_media <= 5,
                            'text-green-400': results.metrics?.adverse_media === 0
                        }"
                        x-text="results.metrics?.adverse_media || 0"></div>
                    <div class="text-sm text-gray-400">Adverse Media</div>
                </div>
                
                <div class="risk-card modern-card text-center">
                    <div class="w-14 h-14 mx-auto mb-3 bg-blue-500/20 rounded-full flex items-center justify-center">
                        <i class="fas fa-users text-2xl text-blue-400"></i>
                    </div>
                    <div class="text-3xl font-bold text-blue-400 mb-1" x-text="results.executives?.length || 0"></div>
                    <div class="text-sm text-gray-400">Executives</div>
                </div>
                
                <div class="risk-card modern-card text-center">
                    <div class="w-14 h-14 mx-auto mb-3 bg-purple-500/20 rounded-full flex items-center justify-center">
                        <i class="fas fa-exclamation-triangle text-2xl text-purple-400"></i>
                    </div>
                    <div class="text-3xl font-bold text-purple-400 mb-1" x-text="results.metrics?.alerts || 0"></div>
                    <div class="text-sm text-gray-400">Risk Alerts</div>
                </div>
            </div>

            <!-- Tabs Navigation -->
            <div class="modern-card p-0">
                <div class="tabs flex overflow-x-auto">
                    <button @click="activeTab = 'overview'" class="tab px-6 py-4"
                        :class="{'active': activeTab === 'overview'}">
                        <i class="fas fa-chart-line mr-2"></i> Overview
                    </button>
                    <button @click="activeTab = 'risk'" class="tab px-6 py-4"
                        :class="{'active': activeTab === 'risk'}">
                        <i class="fas fa-shield-alt mr-2"></i> Risk Assessment
                    </button>
                    <button @click="activeTab = 'company'" class="tab px-6 py-4"
                        :class="{'active': activeTab === 'company'}">
                        <i class="fas fa-building mr-2"></i> Company Details
                    </button>
                    <button @click="activeTab = 'executives'" class="tab px-6 py-4"
                        :class="{'active': activeTab === 'executives'}">
                        <i class="fas fa-users mr-2"></i> Executives
                    </button>
                    <button @click="activeTab = 'media'" class="tab px-6 py-4"
                        :class="{'active': activeTab === 'media'}">
                        <i class="fas fa-newspaper mr-2"></i> Media & News
                    </button>
                    <button @click="activeTab = 'data'" class="tab px-6 py-4"
                        :class="{'active': activeTab === 'data'}">
                        <i class="fas fa-database mr-2"></i> Raw Data
                    </button>
                </div>

                <!-- Tab Content -->
                <div class="p-6">
                    <!-- Overview Tab -->
                    <div x-show="activeTab === 'overview'" class="tab-content space-y-6">
                        <div>
                            <h4 class="text-lg font-semibold mb-3 text-blue-300">
                                <i class="fas fa-file-alt mr-2"></i>Executive Summary
                            </h4>
                            <p class="text-gray-300 leading-relaxed" x-text="results.executive_summary"></p>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div>
                                <h4 class="text-lg font-semibold mb-3 text-blue-300">
                                    <i class="fas fa-chart-pie mr-2"></i>Risk Distribution
                                </h4>
                                <div class="chart-container">
                                    <canvas id="riskDistributionChart"></canvas>
                                </div>
                            </div>
                            <div>
                                <h4 class="text-lg font-semibold mb-3 text-blue-300">
                                    <i class="fas fa-timeline mr-2"></i>Risk Timeline
                                </h4>
                                <div class="chart-container">
                                    <canvas id="riskTimelineChart"></canvas>
                                </div>
                            </div>
                        </div>

                        <div x-show="results.real_data?.categorized_results">
                            <h4 class="text-lg font-semibold mb-3 text-blue-300">
                                <i class="fas fa-layer-group mr-2"></i>Categorized Results
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <template x-for="(category, key) in results.real_data.categorized_results" :key="key">
                                    <div class="bg-gray-800/50 rounded-lg p-4">
                                        <h5 class="font-medium mb-2 capitalize" x-text="key.replace(/_/g, ' ')"></h5>
                                        <div class="text-sm text-gray-400">
                                            <span x-text="typeof category === 'object' ? Object.keys(category).length + ' items' : 'Data available'"></span>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>

                    <!-- Risk Assessment Tab -->
                    <div x-show="activeTab === 'risk'" class="tab-content space-y-6">
                        <div>
                            <h4 class="text-lg font-semibold mb-3 text-blue-300">
                                <i class="fas fa-clipboard-check mr-2"></i>Risk Assessment
                            </h4>
                            <p class="text-gray-300 leading-relaxed mb-4" x-text="results.risk_assessment"></p>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-gray-800/50 rounded-lg p-6">
                                <h5 class="font-semibold mb-4 text-yellow-300">
                                    <i class="fas fa-exclamation-triangle mr-2"></i>Risk Factors
                                </h5>
                                <ul class="space-y-3">
                                    <li class="flex items-start" x-show="results.metrics?.sanctions > 0">
                                        <i class="fas fa-times-circle text-red-400 mt-1 mr-3"></i>
                                        <div>
                                            <div class="font-medium">Sanctions Detected</div>
                                            <div class="text-sm text-gray-400">Found <span x-text="results.metrics.sanctions"></span> sanction matches</div>
                                        </div>
                                    </li>
                                    <li class="flex items-start" x-show="results.metrics?.adverse_media > 0">
                                        <i class="fas fa-exclamation-circle text-yellow-400 mt-1 mr-3"></i>
                                        <div>
                                            <div class="font-medium">Adverse Media</div>
                                            <div class="text-sm text-gray-400">Found <span x-text="results.metrics.adverse_media"></span> negative news items</div>
                                        </div>
                                    </li>
                                    <li class="flex items-start" x-show="results.pep_status">
                                        <i class="fas fa-user-tie text-yellow-400 mt-1 mr-3"></i>
                                        <div>
                                            <div class="font-medium">PEP Exposure</div>
                                            <div class="text-sm text-gray-400">Connected to politically exposed persons</div>
                                        </div>
                                    </li>
                                </ul>
                            </div>

                            <div class="bg-gray-800/50 rounded-lg p-6">
                                <h5 class="font-semibold mb-4 text-green-300">
                                    <i class="fas fa-shield-check mr-2"></i>Mitigation Recommendations
                                </h5>
                                <ul class="space-y-3">
                                    <li class="flex items-start">
                                        <i class="fas fa-check-circle text-green-400 mt-1 mr-3"></i>
                                        <div>
                                            <div class="font-medium">Enhanced Due Diligence</div>
                                            <div class="text-sm text-gray-400">Implement additional verification procedures</div>
                                        </div>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-check-circle text-green-400 mt-1 mr-3"></i>
                                        <div>
                                            <div class="font-medium">Continuous Monitoring</div>
                                            <div class="text-sm text-gray-400">Set up automated alerts for changes</div>
                                        </div>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-check-circle text-green-400 mt-1 mr-3"></i>
                                        <div>
                                            <div class="font-medium">Regular Reviews</div>
                                            <div class="text-sm text-gray-400">Schedule periodic reassessments</div>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Company Details Tab -->
                    <div x-show="activeTab === 'company'" class="tab-content">
                        <div class="bg-gray-800/50 rounded-lg overflow-hidden">
                            <table class="table-modern">
                                <tbody>
                                    <tr>
                                        <td class="font-medium text-gray-400">Company Name</td>
                                        <td x-text="results.company_name"></td>
                                    </tr>
                                    <tr>
                                        <td class="font-medium text-gray-400">Country</td>
                                        <td x-text="results.country || 'Not specified'"></td>
                                    </tr>
                                    <tr>
                                        <td class="font-medium text-gray-400">Industry</td>
                                        <td x-text="results.industry || 'Not available'"></td>
                                    </tr>
                                    <tr>
                                        <td class="font-medium text-gray-400">Founded</td>
                                        <td x-text="results.founded_year || 'Not available'"></td>
                                    </tr>
                                    <tr>
                                        <td class="font-medium text-gray-400">Website</td>
                                        <td>
                                            <a :href="results.website" target="_blank" class="text-blue-400 hover:text-blue-300" x-show="results.website">
                                                <span x-text="results.website"></span>
                                                <i class="fas fa-external-link-alt ml-1"></i>
                                            </a>
                                            <span x-show="!results.website" class="text-gray-500">Not available</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="font-medium text-gray-400">Domain</td>
                                        <td x-text="results.domain || 'Not available'"></td>
                                    </tr>
                                    <template x-if="results.real_data?.categorized_results?.company_info">
                                        <tr>
                                            <td class="font-medium text-gray-400">Description</td>
                                            <td x-text="results.real_data.categorized_results.company_info.description || 'Not available'"></td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Executives Tab -->
                    <div x-show="activeTab === 'executives'" class="tab-content">
                        <div x-show="results.executives && results.executives.length > 0" class="space-y-4">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-lg font-semibold text-blue-300">
                                    <i class="fas fa-users mr-2"></i>Key Executives
                                </h4>
                                <span class="text-sm text-gray-400">
                                    <span x-text="results.executives.length"></span> executives found
                                </span>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <template x-for="executive in results.executives" :key="executive.name">
                                    <div class="bg-gray-800/50 rounded-lg p-4 flex items-start space-x-4">
                                        <div class="w-12 h-12 bg-gray-700 rounded-full flex items-center justify-center flex-shrink-0">
                                            <i class="fas fa-user text-gray-400"></i>
                                        </div>
                                        <div class="flex-1">
                                            <h5 class="font-semibold" x-text="executive.name"></h5>
                                            <p class="text-sm text-gray-400" x-text="executive.position || 'Executive'"></p>
                                            <div class="mt-2">
                                                <span class="badge text-xs"
                                                    :class="{
                                                        'badge-danger': executive.risk_level === 'High',
                                                        'badge-warning': executive.risk_level === 'Medium',
                                                        'badge-success': executive.risk_level === 'Low'
                                                    }">
                                                    <span x-text="executive.risk_level"></span> Risk
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                        <div x-show="!results.executives || results.executives.length === 0" 
                            class="text-center py-12 text-gray-400">
                            <i class="fas fa-users text-4xl mb-4"></i>
                            <p>No executive information available</p>
                        </div>
                    </div>

                    <!-- Media & News Tab -->
                    <div x-show="activeTab === 'media'" class="tab-content space-y-6">
                        <div x-show="results.citations && results.citations.length > 0">
                            <h4 class="text-lg font-semibold mb-4 text-blue-300">
                                <i class="fas fa-newspaper mr-2"></i>Recent News & Media
                            </h4>
                            <div class="space-y-4">
                                <template x-for="(citation, index) in results.citations.slice(0, 10)" :key="index">
                                    <div class="bg-gray-800/50 rounded-lg p-4 hover:bg-gray-800/70 transition-colors">
                                        <h5 class="font-medium mb-1" x-text="citation.title"></h5>
                                        <a :href="citation.url" target="_blank" 
                                            class="text-sm text-blue-400 hover:text-blue-300">
                                            View Source <i class="fas fa-external-link-alt ml-1"></i>
                                        </a>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <div x-show="results.real_data?.categorized_results?.adverse_media" class="mt-6">
                            <h4 class="text-lg font-semibold mb-4 text-red-300">
                                <i class="fas fa-exclamation-triangle mr-2"></i>Adverse Media
                            </h4>
                            <div class="space-y-4">
                                <template x-for="item in results.real_data.categorized_results.adverse_media" :key="item.headline">
                                    <div class="bg-red-900/20 border border-red-800 rounded-lg p-4">
                                        <h5 class="font-medium text-red-300 mb-2" x-text="item.headline"></h5>
                                        <p class="text-sm text-gray-300 mb-2" x-text="item.summary"></p>
                                        <div class="flex items-center justify-between">
                                            <span class="text-xs text-gray-400" x-text="item.date"></span>
                                            <a :href="item.source_url" target="_blank" 
                                                class="text-sm text-red-400 hover:text-red-300">
                                                View Source <i class="fas fa-external-link-alt ml-1"></i>
                                            </a>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>

                    <!-- Raw Data Tab -->
                    <div x-show="activeTab === 'data'" class="tab-content">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="text-lg font-semibold text-blue-300">
                                <i class="fas fa-code mr-2"></i>Raw API Response
                            </h4>
                            <div class="flex items-center space-x-2">
                                <button @click="copyJSON" class="btn-outline text-sm px-3 py-1">
                                    <i class="fas fa-copy mr-1"></i> Copy
                                </button>
                                <button @click="downloadJSON" class="btn-outline text-sm px-3 py-1">
                                    <i class="fas fa-download mr-1"></i> Download
                                </button>
                            </div>
                        </div>
                        <div class="bg-gray-900 rounded-lg p-4 overflow-auto max-h-96">
                            <pre class="text-sm text-gray-300"><code x-text="JSON.stringify(results, null, 2)"></code></pre>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="modern-card flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button @click="saveSearch" class="btn-outline px-4 py-2 rounded-lg">
                        <i class="fas fa-bookmark mr-2"></i> Save Search
                    </button>
                    <button @click="exportReport" class="btn-outline px-4 py-2 rounded-lg">
                        <i class="fas fa-file-pdf mr-2"></i> Export Report
                    </button>
                    <button @click="scheduleMonitoring" class="btn-outline px-4 py-2 rounded-lg">
                        <i class="fas fa-clock mr-2"></i> Schedule Monitoring
                    </button>
                </div>
                <button @click="newSearch" class="btn-primary px-6 py-2 rounded-lg">
                    <i class="fas fa-plus mr-2"></i> New Search
                </button>
            </div>
        </div>
    </main>

    <script>
        function companyScreeningApp() {
            return {
                searchForm: {
                    company: '',
                    country: '',
                    domain: '',
                    level: 'standard'
                },
                loading: false,
                loadingMessage: 'Initializing search...',
                loadingProgress: 0,
                results: null,
                activeTab: 'overview',
                showHistory: false,
                showSaved: false,
                showNotifications: false,

                init() {
                    // Initialize charts when results are loaded
                    this.$watch('results', (value) => {
                        if (value) {
                            this.$nextTick(() => {
                                this.initCharts();
                            });
                        }
                    });
                },

                performSearch() {
                    this.loading = true;
                    this.loadingProgress = 0;
                    this.results = null;
                    
                    // Simulate progress
                    const progressInterval = setInterval(() => {
                        if (this.loadingProgress < 90) {
                            this.loadingProgress += Math.random() * 15;
                            this.updateLoadingMessage();
                        }
                    }, 500);

                    // Make API call
                    fetch('/api/screen', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(this.searchForm)
                    })
                    .then(response => response.json())
                    .then(data => {
                        clearInterval(progressInterval);
                        this.loadingProgress = 100;
                        setTimeout(() => {
                            this.results = data;
                            this.loading = false;
                            this.activeTab = 'overview';
                        }, 500);
                    })
                    .catch(error => {
                        clearInterval(progressInterval);
                        this.loading = false;
                        alert('Error performing search: ' + error.message);
                    });
                },

                updateLoadingMessage() {
                    const messages = [
                        'Searching company databases...',
                        'Checking sanctions lists...',
                        'Analyzing media coverage...',
                        'Evaluating risk factors...',
                        'Compiling executive profiles...',
                        'Generating risk assessment...'
                    ];
                    const index = Math.floor((this.loadingProgress / 100) * messages.length);
                    this.loadingMessage = messages[Math.min(index, messages.length - 1)];
                },

                getRiskScore() {
                    if (!this.results) return 0;
                    switch (this.results.overall_risk_level) {
                        case 'Low': return 85 + Math.floor(Math.random() * 15);
                        case 'Medium': return 50 + Math.floor(Math.random() * 20);
                        case 'High': return 20 + Math.floor(Math.random() * 20);
                        default: return 0;
                    }
                },

                initCharts() {
                    // Risk Distribution Chart
                    const riskCtx = document.getElementById('riskDistributionChart');
                    if (riskCtx) {
                        new Chart(riskCtx, {
                            type: 'doughnut',
                            data: {
                                labels: ['Sanctions', 'Adverse Media', 'Other Risks'],
                                datasets: [{
                                    data: [
                                        this.results.metrics?.sanctions || 0,
                                        this.results.metrics?.adverse_media || 0,
                                        this.results.metrics?.alerts || 0
                                    ],
                                    backgroundColor: [
                                        'rgba(239, 68, 68, 0.8)',
                                        'rgba(251, 191, 36, 0.8)',
                                        'rgba(139, 92, 246, 0.8)'
                                    ]
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'bottom',
                                        labels: { color: '#e2e8f0' }
                                    }
                                }
                            }
                        });
                    }

                    // Risk Timeline Chart
                    const timelineCtx = document.getElementById('riskTimelineChart');
                    if (timelineCtx) {
                        new Chart(timelineCtx, {
                            type: 'line',
                            data: {
                                labels: ['6 months ago', '5 months ago', '4 months ago', '3 months ago', '2 months ago', '1 month ago', 'Current'],
                                datasets: [{
                                    label: 'Risk Score',
                                    data: [45, 48, 52, 49, 55, 58, this.getRiskScore()],
                                    borderColor: 'rgba(99, 102, 241, 1)',
                                    backgroundColor: 'rgba(99, 102, 241, 0.1)',
                                    tension: 0.4
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: { display: false }
                                },
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        max: 100,
                                        grid: { color: 'rgba(148, 163, 184, 0.1)' },
                                        ticks: { color: '#e2e8f0' }
                                    },
                                    x: {
                                        grid: { color: 'rgba(148, 163, 184, 0.1)' },
                                        ticks: { color: '#e2e8f0' }
                                    }
                                }
                            }
                        });
                    }
                },

                copyJSON() {
                    navigator.clipboard.writeText(JSON.stringify(this.results, null, 2))
                        .then(() => alert('JSON copied to clipboard'))
                        .catch(err => alert('Failed to copy: ' + err));
                },

                downloadJSON() {
                    const blob = new Blob([JSON.stringify(this.results, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${this.results.company_name.replace(/\s+/g, '_')}_screening.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                },

                saveSearch() {
                    // Implementation for saving search
                    alert('Search saved successfully');
                },

                exportReport() {
                    // Implementation for exporting report
                    alert('Report export started');
                },

                scheduleMonitoring() {
                    // Implementation for scheduling monitoring
                    alert('Monitoring scheduled');
                },

                newSearch() {
                    this.results = null;
                    this.searchForm = {
                        company: '',
                        country: '',
                        domain: '',
                        level: 'standard'
                    };
                }
            };
        }
    </script>
</body>
</html>